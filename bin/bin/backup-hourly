#!/bin/bash

CURRENT_DATE=$(date "+%Y-%m-%d:%H")

. $CAD_ETC_PATH/BACKUP.cfg
if [ ! -d "${CAD_BACKUP_PATH}" ]; then
  echo "Backup folder does not exist, not continuing with backup"
  echo "ERROR: $CAD_BACKUP_PATH does not exist or is not mounted" > $CAD_BACKUP_LOG_PATH/hourly~$CURRENT_DATE.log
  exit
fi
echo "Backup folder exists... proceeding with backup"

# Backup all of /home and /var/www except a few
# excluded directories
borg create -v --stats \
    $CAD_BACKUP_PATH::`hostname`-`date +%Y-%m-%d:%H` \
    /home \
    &>> $CAD_BACKUP_LOG_PATH/hourly~$CURRENT_DATE.log

